<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>[DEBUG v5] Resultados - Lotofácil (sorteio = 15 dezenas)</title>
<style>
 body{margin:0;padding:0;font-family:Arial,sans-serif;background:#0b1354;color:#fff;display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:20px}
 h1{font-size:24px;margin:6px 0 2px;text-align:center}
 .badge{font-size:12px;opacity:.9;margin-bottom:10px}
 input{margin:12px 0;padding:10px;font-size:18px;border-radius:5px;border:none;width:92%;max-width:560px;text-align:center}
 button{padding:10px 20px;font-size:18px;background:#fff;color:#0b1354;border:none;border-radius:5px;cursor:pointer}
 button:hover{background:#ddd}
 #status,#resultadoEntrada{margin-top:8px;font-size:14px;opacity:.95;white-space:pre-wrap}
 #results{margin-top:16px;width:100%;max-width:900px}
 .card{background:rgba(255,255,255,.08);padding:14px;margin:10px 0;border-radius:8px;border:1px solid rgba(255,255,255,.15)}
 .title{font-weight:700;font-size:18px;margin-bottom:6px}
 .meta{font-size:13px;opacity:.9;margin-bottom:6px}
 code{background:rgba(255,255,255,.1);padding:0 4px;border-radius:4px}
 .pill{display:inline-block;background:#16a34a;color:#fff;border-radius:999px;padding:2px 8px;font-size:12px;margin-left:6px}
</style>
<script>
const SORTEIO_COUNT = 15;
function parseSemSeparadores(digits, expectedCount) {
  const nums=[]; let i=0;
  while(i<digits.length){
    if(nums.length>expectedCount) break;
    const ch=digits[i];
    if(ch==='0'){
      if(i+1>=digits.length) return null;
      const n=parseInt(digits.substr(i,2),10);
      if(n<1||n>9) return null;
      nums.push(n); i+=2;
    } else if(ch==='1'||ch==='2'){
      if(i+1<digits.length){
        const two=parseInt(digits.substr(i,2),10);
        if(two>=10&&two<=25){ nums.push(two); i+=2; continue; }
      }
      const one=parseInt(ch,10);
      if(one<1||one>9) return null;
      nums.push(one); i+=1;
    } else {
      const one=parseInt(ch,10);
      if(one<1||one>9) return null;
      nums.push(one); i+=1;
    }
    if(nums.length===expectedCount && i<digits.length){ return null; }
  }
  return nums;
}
function processarEntrada(){
  const inputEl=document.getElementById("dezenas");
  const status=document.getElementById("status");
  const input=inputEl.value.trim();
  status.textContent="";
  const onlyDigits=input.replace(/[^0-9]/g,"");
  let numeros=parseSemSeparadores(onlyDigits,SORTEIO_COUNT);
  if(!numeros){
    const candidatos=input.split(/[^0-9]+/).filter(Boolean).map(x=>parseInt(x,10));
    if(candidatos.length===SORTEIO_COUNT && candidatos.every(n=>n>=0&&n<=25)){ numeros=candidatos; }
  }
  if(!numeros){ status.textContent=`[DEBUG] Esperado ${SORTEIO_COUNT} dezenas. Entrada recebida: "${input}" (somente dígitos="${onlyDigits}", len=${onlyDigits.length}).`; alert("Entrada inválida para 15 dezenas."); return null; }
  if(numeros.some(n=>n<1||n>25)){ status.textContent="[DEBUG] Há número fora de 1..25: "+JSON.stringify(numeros); alert("Todas as dezenas devem estar entre 01 e 25."); return null; }
  if((new Set(numeros)).size!==SORTEIO_COUNT){ status.textContent="[DEBUG] Repetição detectada: "+JSON.stringify(numeros); alert("As 15 dezenas do sorteio não podem se repetir."); return null; }
  numeros.sort((a,b)=>a-b);
  document.getElementById("resultadoEntrada").textContent="Sorteio processado: "+numeros.map(n=>String(n).padStart(2,"0")).join(" - ");
  console.log("[DEBUG] numeros =",numeros);
  return numeros;
}
async function verificarResultados(){
  const numeros=processarEntrada();
  if(!numeros) return;
  const status=document.getElementById("status");
  status.innerHTML=`Lendo JSONs... <span class="pill">SORTEIO_COUNT=${SORTEIO_COUNT}</span>`;
  if(location.protocol==="file:"){
    status.innerHTML += "\n⚠️ Abrir como file:// bloqueia fetch. Use um servidor (ex.: python -m http.server) ou publique no GitHub Pages.";
  }
  let usuarios,bolao;
  try{
    const [u,b]=await Promise.all([fetch("usuarios_com_palpite_lotofacil.json"),fetch("bolao_lotofacil.json")]);
    if(!u.ok||!b.ok) throw new Error("HTTP não OK");
    usuarios=await u.json(); bolao=await b.json();
  }catch(e){
    status.textContent="Erro ao carregar JSONs. Estão na mesma pasta? Está via HTTP?"; console.error(e); alert("Erro ao carregar JSONs."); return;
  }
  const resultsDiv=document.getElementById("results");
  resultsDiv.innerHTML="";
  let encontrou=false;
  const parseJogo=(str)=>str.split(/[^0-9]+/).filter(Boolean).map(x=>parseInt(x,10));
  const contarAcertos=(lst)=>lst.filter(x=>numeros.includes(x)).length;
  bolao.forEach(j=>{
    const dezenasBolao=parseJogo(j["JOGO"]);
    const acertosBolao=contarAcertos(dezenasBolao);
    const idBolao=j["ID BOLÃO"]||j["ID BOLAO"]||"";
    const nomeBolao=j["NOME BOLÃO"]||j["NOME BOLAO"]||"BOLÃO";
    const idJogo=j["ID JOGO"]||"";
    usuarios.forEach(u=>{
      const nomeUsuario=u["Usuários"]||u["Usuário"]||u["JOGADOR"]||"Participante";
      Object.keys(u).filter(k=>/^Jogo\s+\d+/.test(k)).forEach(chaveJogo=>{
        const dezenasPalpite=parseJogo(u[chaveJogo]);
        const acertosPalpite=contarAcertos(dezenasPalpite);
        if(acertosBolao>=11 && acertosBolao===acertosPalpite){
          encontrou=true;
          let titulo="";
          if(acertosBolao===15) titulo="15 ACERTOS (PREMIAÇÃO MÁXIMA)";
          else if(acertosBolao===14) titulo="14 ACERTOS";
          else if(acertosBolao===13) titulo="13 ACERTOS";
          else if(acertosBolao===12) titulo="12 ACERTOS";
          else if(acertosBolao===11) titulo="11 ACERTOS";
          const acertosLista=dezenasBolao.filter(n=>numeros.includes(n)).map(n=>String(n).padStart(2,"0")).join(", ");
          const card=document.createElement("div");
          card.className="card";
          card.innerHTML=`
            <div class="title">${titulo}</div>
            <div class="meta">Bolão: <b>${nomeBolao}</b> | ID do Bolão: <b>${idBolao}</b> | Linha: <b>${idJogo}</b></div>
            <div>Acertos: ${acertosLista} (${acertosBolao})</div>
            <div>Palpite: <b>${nomeUsuario}</b> (${chaveJogo})</div>`;
          resultsDiv.appendChild(card);
        }
      });
    });
  });
  status.textContent = encontrou ? "Conferência concluída." : "NÃO FOI DESTA VEZ";
}
</script>
</head>
<body>
  <h1>Verificar Resultados - Lotofácil</h1>
  <div class="badge">[DEBUG v5] — Sorteio esperado: <b>15 dezenas</b> — <code>pagina3.html?v=5</code></div>
  <p class="hint">Digite as <b>15 dezenas do sorteio</b> em QUALQUER ORDEM e <b>SEM separadores</b> (ex.: <code>010203040506070809101112131</code>).<br/>
  Também aceita separadores (espaço, vírgula, hífen) e números sem zero à esquerda.</p>
  <input id="dezenas" type="text" placeholder="Cole ou digite as 15 dezenas do sorteio" />
  <button onclick="verificarResultados()">Verificar</button>
  <div id="status"></div>
  <p id="resultadoEntrada"></p>
  <div id="results"></div>
</body>
</html>
