<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Verificador Mega-Sena</title>

  <style>
    body{
      margin:0;padding:0;font-family:Arial,sans-serif;background:#0b1354;color:#fff;
      min-height:100vh;padding:20px;
      display:flex;flex-direction:column;align-items:center;
    }
    h1{margin:10px 0 6px}
    input{
      margin:14px 0;padding:12px;font-size:18px;border-radius:6px;border:none;
      width:92%;max-width:520px;text-align:center
    }
    button{
      padding:10px 25px;font-size:18px;background:#fff;color:#0b1354;border:none;
      border-radius:6px;cursor:pointer
    }
    button:hover{background:#ddd}
    #resultadoEntrada{margin-top:10px;font-size:14px;opacity:.95;text-align:center}
    #status{margin-top:10px;font-size:13px;opacity:.95;white-space:pre-wrap;text-align:center;max-width:920px}
    #results{margin-top:20px;width:100%;max-width:920px}
    .card{
      background:rgba(255,255,255,.08);padding:15px;margin:10px 0;border-radius:8px;
      border:1px solid rgba(255,255,255,.15)
    }
    .title{font-weight:700;font-size:18px;margin-bottom:8px}
    .meta{font-size:13px;line-height:1.5}
    code{background:rgba(255,255,255,.12);padding:2px 6px;border-radius:6px}
    .warn{color:#ffd966}
    .errbox{
      display:none;
      width:100%;
      max-width:920px;
      margin-top:12px;
      background:rgba(255,0,0,.18);
      border:1px solid rgba(255,0,0,.35);
      padding:12px;
      border-radius:8px;
      white-space:pre-wrap;
      font-size:13px;
    }
  </style>
</head>

<body>

  <h1>Verificador Mega-Sena</h1>

  <div class="errbox" id="errbox"></div>

  <input id="dezenas" type="text" placeholder="Digite as 6 dezenas do sorteio" />
  <button id="btnVerificar">Verificar</button>

  <div id="status"></div>
  <p id="resultadoEntrada"></p>
  <div id="results"></div>

<script>
(() => {
  const SORTEIO_COUNT = 6;

  const errbox = document.getElementById("errbox");
  function showError(msg){
    errbox.style.display = "block";
    errbox.textContent = "ERRO:\n" + msg;
  }

  window.addEventListener("error", (e) => {
    showError(e.message || String(e.error || e));
  });

  function pad2(n){ return String(n).padStart(2,"0"); }

  function getCampo(obj, nomes){
    for(const n of nomes){
      if(obj && Object.prototype.hasOwnProperty.call(obj, n) && obj[n] != null && obj[n] !== ""){
        return obj[n];
      }
    }
    return "";
  }

  function normalizarJogo(str){
    const nums = String(str || "")
      .split(/[^0-9]+/)
      .filter(Boolean)
      .map(x => parseInt(x,10))
      .filter(n => !Number.isNaN(n))
      .filter(n => n>=1 && n<=60);

    if(nums.length !== 6) return null;
    if(new Set(nums).size !== 6) return null;

    nums.sort((a,b)=>a-b);
    return nums.map(pad2).join("-");
  }

  function parseSemSeparadoresMega(digits){
    if(digits.length !== 12) return null;
    const nums=[];
    for(let i=0;i<digits.length;i+=2){
      const n=parseInt(digits.substr(i,2),10);
      if(n<1 || n>60) return null;
      nums.push(n);
    }
    return nums;
  }

  function processarEntrada(){
    const input = document.getElementById("dezenas").value.trim();
    const onlyDigits = input.replace(/[^0-9]/g,"");

    let nums = parseSemSeparadoresMega(onlyDigits);

    if(!nums){
      const partes = input
        .split(/[^0-9]+/)
        .filter(Boolean)
        .map(x => parseInt(x,10))
        .filter(n => !Number.isNaN(n));
      if(partes.length === SORTEIO_COUNT) nums = partes;
    }

    if(!nums){
      alert("Digite exatamente 6 dezenas (01 a 60).");
      return null;
    }
    if(nums.some(n => n<1 || n>60)){
      alert("As dezenas devem estar entre 01 e 60.");
      return null;
    }
    if(new Set(nums).size !== SORTEIO_COUNT){
      alert("As dezenas não podem se repetir.");
      return null;
    }

    nums.sort((a,b)=>a-b);
    document.getElementById("resultadoEntrada").textContent =
      "Sorteio processado: " + nums.map(pad2).join(" - ");
    return nums;
  }

  async function verificarResultados(){
    const status = document.getElementById("status");
    const results = document.getElementById("results");
    status.textContent = "";
    results.innerHTML = "";
    errbox.style.display = "none";
    errbox.textContent = "";

    const sorteio = processarEntrada();
    if(!sorteio) return;

    status.textContent = "Conferindo...";

    let bolao, usuarios;
    try{
      const [b,u] = await Promise.all([
        fetch("bolao_lotofacil.json", { cache: "no-store" }),
        fetch("usuarios_com_palpite_lotofacil.json", { cache: "no-store" })
      ]);
      if(!b.ok) throw new Error("Erro ao abrir bolao");
      if(!u.ok) throw new Error("Erro ao abrir usuarios");
      bolao = await b.json();
      usuarios = await u.json();
    }catch(e){
      showError(String(e));
      return;
    }

    const donosPorJogo = new Map();

    for(const u of usuarios){
      const nomeUsuario = getCampo(u, ["Usuário","Usuários","JOGADOR"]) || "Participante";
      const chaves = Object.keys(u).filter(k => /^Jogo\s*\d+$/i.test(k));
      for(const chave of chaves){
        const jogoNorm = normalizarJogo(u[chave]);
        if(!jogoNorm) continue;
        if(!donosPorJogo.has(jogoNorm)) donosPorJogo.set(jogoNorm, []);
        donosPorJogo.get(jogoNorm).push({ usuario: nomeUsuario, campo: chave });
      }
    }

    const contarAcertos = (jogoNums) => jogoNums.filter(n => sorteio.includes(n)).length;

    let premiou = false;

    for(const linha of bolao){
      const jogoNorm = normalizarJogo(getCampo(linha, ["JOGO","Jogo","jogo"]));
      if(!jogoNorm) continue;

      const dezenasLinha = jogoNorm.split("-").map(x => parseInt(x,10));
      const acertos = contarAcertos(dezenasLinha);

      let msg="";
      if(acertos===6) msg="Vocês Ganharam a Mega Sena!";
      else if(acertos===5) msg="Vocês Ganharam a Quina!";
      else if(acertos===4) msg="Vocês Ganharam a Quadra!";
      else continue;

      premiou = true;

      const idBolao = getCampo(linha, ["ID BOLÃO","ID BOLAO"]);
      const nomeBolao = getCampo(linha, ["NOME BOLÃO","NOME BOLAO"]);
      const idJogo = getCampo(linha, ["ID JOGO","ID_JOGO","LINHA"]);

      const acertosLista = dezenasLinha
        .filter(n => sorteio.includes(n))
        .map(pad2).join(", ");

      const donos = donosPorJogo.get(jogoNorm) || [];
      const donoHtml = donos.length
        ? donos.map(d => `<b>${d.usuario}</b> (${d.campo})`).join(" | ")
        : `<span class="warn">(Sem dono identificado)</span>`;

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="title">${msg}</div>
        <div class="meta">
          Bolão: <b>${nomeBolao || "-"}</b><br/>
          ID do Bolão: <b>${idBolao || "-"}</b><br/>
          Linha: <b>${idJogo || "-"}</b><br/>
          Jogo: <code>${jogoNorm}</code><br/>
          Acertos (${acertos}): ${acertosLista || "-"}<br/>
          Palpite de: ${donoHtml}
        </div>
      `;
      results.appendChild(card);
    }

    if(!premiou){
      results.innerHTML = `<div class="card"><b>Não Foi Desta Vez!</b></div>`;
    }

    status.textContent = "Conferência concluída.";
  }

  document.getElementById("btnVerificar").addEventListener("click", verificarResultados);
})();
</script>

</body>
</html>



